<template>
    <lightning-card title="Actions">
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading channels" variant="brand"></lightning-spinner>
        </template>
        <div class="slds-p-horizontal_small">
            <lightning-accordion active-section-name="subscribeAll" allow-multiple-sections-open>
                
                <!-- Subscribe to ALL event -->
                <lightning-accordion-section name="subscribeAll" label="Subscribe to all events">
                    <p>Subscribe to all streaming events&nbsp;
                        <lightning-helptext content="Custom Change Data Capture (CDC) 'group channels' are not automatically discovered. Supported events: PushTopic events, generic events, platform events and CDC events."></lightning-helptext>
                    </p>
                    <lightning-combobox label="Replay option" value={subAllReplay} onchange={handleSubAllReplayChange} options={replayOptions}></lightning-combobox>
                    <div class="slds-align_absolute-center slds-m-top_medium">
                        <lightning-button variant="brand" label="Subscribe to all" onclick={handleSubscribeAll}></lightning-button>
                    </div>
                </lightning-accordion-section>
                
                <!-- Subscribe to an event -->
                <lightning-accordion-section name="subscribe" label="Subscribe to an event">
                    <lightning-combobox label="Event type" value={subEventType} options={eventTypes} placeholder="Select type" onchange={handleSubEventTypeChange}></lightning-combobox>
                    <lightning-combobox label="Event name" value={subEventName} options={subEventNames} placeholder={subEventNamePlaceholder} onchange={handleSubEventNameChange} disabled={isSubEventNameDisabled}></lightning-combobox>
                    <lightning-input label="Streaming channel" value={subChannel} disabled></lightning-input>
                    <lightning-combobox label="Replay option" value={subReplay} onchange={handleSubReplayChange} options={replayOptions} disabled={isSubscribeDisabled}></lightning-combobox>
                    <div class="slds-align_absolute-center slds-m-top_medium">
                        <lightning-button variant="brand" label="Subscribe" onclick={handleSubscribe} disabled={isSubscribeDisabled}></lightning-button>
                    </div>
                </lightning-accordion-section>
                
                <!-- Publish an event -->
                <lightning-accordion-section name="publish" label="Publish an event">
                    <lightning-combobox label="Event type" value={pubEventType} options={eventTypes} placeholder="Select type" onchange={handlePubEventTypeChange}></lightning-combobox>
                    <template if:true={pubEventType}>
                        <!-- Manual publish allowed -->
                        <template if:true={isManualPublishedAllowed}>
                            <lightning-combobox label="Event name" value={pubEventName} options={pubEventNames} placeholder={pubEventNamePlaceholder}  onchange={handlePubEventNameChange} disabled={isPubEventNameDisabled}></lightning-combobox>
                            <lightning-input label="Streaming channel" value={pubChannel} disabled></lightning-input>
                            <lightning-textarea label="Event payload" value={pubPayload} onchange={handlePubPayloadChange} disabled={isPublishDisabled} field-level-help="JSON formatted payload with strings delimited by double quotes"></lightning-textarea>
                            <div class="slds-align_absolute-center slds-m-top_medium">
                                <lightning-button variant="brand" label="Publish" onclick={handlePublish} disabled={isPublishDisabled}></lightning-button>
                            </div>
                        </template>
                        <!-- Manual publish not allowed -->
                        <template if:false={isManualPublishedAllowed}>
                            <div class="slds-media slds-media_center slds-m-vertical_small">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="utility:info" size="small" alternative-text="Info icon"></lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <p>This type of event can only be published via record updates.</p>
                                </div>
                            </div>
                        </template>
                    </template>
                </lightning-accordion-section>
                
                <!-- Register an event type -->
                <lightning-accordion-section name="register" label="Register/Activate an event source">
                    <lightning-combobox label="Event type" value={regEventType} options={eventTypes} onchange={handleRegEventTypeChange} placeholder="Select type" class="slds-m-bottom_medium"></lightning-combobox>
            
                        <template if:true={isPushTopicReg}>
                                <p class="slds-m-bottom_small">Customize and execute the following code in Apex to register a new PushTopic:</p>
                                <p class="slds-textarea push-topic-code">
                                    PushTopic pushTopic = new PushTopic();<br/>
                                    pushTopic.Name = 'InvoiceStatementUpdates';<br/>
                                    pushTopic.Query = 'SELECT Id, Name, Status__c, Description__c FROM Invoice_Statement__c';<br/>
                                    pushTopic.ApiVersion = 46.0;<br/>
                                    pushTopic.NotifyForOperationCreate = true;<br/>
                                    pushTopic.NotifyForOperationUpdate = true;<br/>
                                    pushTopic.NotifyForOperationUndelete = true;<br/>
                                    pushTopic.NotifyForOperationDelete = true;<br/>
                                    pushTopic.NotifyForFields = 'Referenced';<br/>
                                    insert pushTopic;
                                </p>
                        </template>
                        <template if:true={isGenericReg}>
                            Navigate to the <a href="/lightning/o/StreamingChannel/list">Streaming Channel</a> tab to register a generic event.
                        </template>
                        <template if:true={isPlatformEventReg}>
                            Navigate to the <a href="/lightning/setup/EventObjects/home">Platform Event</a> page in Setup to register a platform event.
                        </template>
                        <template if:true={isCDCReg}>
                            Navigate to the <a href="/lightning/setup/CdcObjectEnablement/home">Change Data Capture</a> page in Setup to activate a change data capture event.
                        </template>
                </lightning-accordion-section>
            </lightning-accordion>
        </div>
    </lightning-card>
</template>